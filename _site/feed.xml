<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ivan Maslov: Full-Stack Web Engineer</title>
    <description>Ivan Maslov: Full-Stack Web Engineer Personal Site.
</description>
    <link>http://studentivan.ru/</link>
    <atom:link href="http://studentivan.ru/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Wed, 28 Sep 2016 06:00:06 +0400</pubDate>
    <lastBuildDate>Wed, 28 Sep 2016 06:00:06 +0400</lastBuildDate>
    <generator>Jekyll v3.1.6</generator>
    
      <item>
        <title>Using bash script for deploying</title>
        <description>&lt;p&gt;Recently I had to connect the phpCI as a continuous integration system to the system consisting of several distributed servers with access via ssh+password (sad but ssh-keys were disallowed). It was decided to use ssh+scp+sshpass and then phpCI could upload builds to remote servers. For this purpose I wrote the following script:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# example: ./build.sh -b mylatestbuild -a myuser@myserver.ru -d /var/www/myuser/data -r /var/www/myuser/data/www/mysite.ru -p 123456&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$# &lt;/span&gt;-gt 1 &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;do
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    -b|--buildpath&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;BUILD_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$2&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;shift&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# past argument&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    -a|--remoteauth&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;REMOTE_AUTH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$2&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;shift&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# past argument&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    -r|--remoteprojectroot&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;REMOTE_PROJECT_ROOT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$2&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;shift&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# past argument&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    -p|--password&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;SSH_PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$2&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;shift&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# past argument&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    -d|--remotedestination&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;REMOTE_DESTINATION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$2&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;shift&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# past argument&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    --default&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;DEFAULT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES
    &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;c&quot;&gt;# unknown option&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;esac&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;shift&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# past argument or value&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;done

&lt;/span&gt;tar -cf &lt;span class=&quot;nv&quot;&gt;$BUILD_PATH&lt;/span&gt;/build.tar --directory&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$BUILD_PATH&lt;/span&gt; index.php
tar -uf &lt;span class=&quot;nv&quot;&gt;$BUILD_PATH&lt;/span&gt;/build.tar --directory&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$BUILD_PATH&lt;/span&gt; frontend
tar -uf &lt;span class=&quot;nv&quot;&gt;$BUILD_PATH&lt;/span&gt;/build.tar --directory&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$BUILD_PATH&lt;/span&gt; acme
gzip build.tar
sshpass -p &lt;span class=&quot;nv&quot;&gt;$SSH_PASSWORD&lt;/span&gt; scp -o &lt;span class=&quot;nv&quot;&gt;UserKnownHostsFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/null -o &lt;span class=&quot;nv&quot;&gt;StrictHostKeyChecking&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;no &lt;span class=&quot;nv&quot;&gt;$BUILD_PATH&lt;/span&gt;/build.tar.gz &lt;span class=&quot;nv&quot;&gt;$REMOTE_AUTH&lt;/span&gt;:&lt;span class=&quot;nv&quot;&gt;$REMOTE_DESTINATION&lt;/span&gt;
sshpass -p &lt;span class=&quot;nv&quot;&gt;$SSH_PASSWORD&lt;/span&gt; ssh -o &lt;span class=&quot;nv&quot;&gt;UserKnownHostsFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/null -o &lt;span class=&quot;nv&quot;&gt;StrictHostKeyChecking&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;no &lt;span class=&quot;nv&quot;&gt;$REMOTE_AUTH&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;rm -rf &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$REMOTE_PROJECT_ROOT&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/frontend &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$REMOTE_PROJECT_ROOT&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/acme&quot;&lt;/span&gt;
sshpass -p &lt;span class=&quot;nv&quot;&gt;$SSH_PASSWORD&lt;/span&gt; ssh -o &lt;span class=&quot;nv&quot;&gt;UserKnownHostsFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/null -o &lt;span class=&quot;nv&quot;&gt;StrictHostKeyChecking&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;no &lt;span class=&quot;nv&quot;&gt;$REMOTE_AUTH&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;tar -zxf &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$REMOTE_DESTINATION&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/build.tar.gz -C &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$REMOTE_PROJECT_ROOT&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The script is simple.
&lt;code class=&quot;highlighter-rouge&quot;&gt;frontend&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;acme&lt;/code&gt; are just example folders - use your own instead.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sshpass&lt;/code&gt; using only for password authorization. So You can remove it for ssh-keys auth.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no&lt;/code&gt; is using for pass unknown host error.&lt;/p&gt;

&lt;p&gt;Hope that I saved a little bit of your time.&lt;/p&gt;
</description>
        <pubDate>Tue, 27 Sep 2016 21:19:35 +0400</pubDate>
        <link>http://studentivan.ru/blog/bash/deploy/ssh/2016/09/27/using-bash-script-for-deploying.html</link>
        <guid isPermaLink="true">http://studentivan.ru/blog/bash/deploy/ssh/2016/09/27/using-bash-script-for-deploying.html</guid>
        
        
        <category>blog</category>
        
        <category>bash</category>
        
        <category>deploy</category>
        
        <category>ssh</category>
        
      </item>
    
  </channel>
</rss>
